# Dockerfile for pxl-core service
FROM ocaml/opam:debian-12-ocaml-4.14

# Copy extracted OCaml code
COPY extraction/pxl_core.ml /app/pxl_core.ml

# Compile with ocamlc
RUN ocamlc -o /app/pxl_core.exe /app/pxl_core.ml

# Health check
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:8080/healthz || exit 1

# Expose port
EXPOSE 8080

# Run
CMD ["/app/pxl_core.exe"]
{{- $component := "tool-router" -}}
apiVersion: v1
kind: Service
metadata:
  name: {{ include "logos.toolRouter.fullname" . }}
  labels:
    {{- include "logos.labels" . | nindent 4 }}
    app.kubernetes.io/component: {{ $component }}
spec:
  type: {{ .Values.toolRouter.service.type }}
  ports:
    - port: {{ .Values.toolRouter.service.port }}
      targetPort: http
      protocol: TCP
      name: http
    - port: 9090
      targetPort: metrics
      protocol: TCP
      name: metrics
  selector:
    {{- $ctx := merge (dict "component" $component) . -}}
    {{- include "logos.componentSelectorLabels" $ctx | nindent 4 }}
---
{{- $component := "logos-api" -}}
apiVersion: v1
kind: Service
metadata:
  name: {{ include "logos.logosApi.fullname" . }}
  labels:
    {{- include "logos.labels" . | nindent 4 }}
    app.kubernetes.io/component: {{ $component }}
spec:
  type: {{ .Values.logosApi.service.type }}
  ports:
    - port: {{ .Values.logosApi.service.port }}
      targetPort: http
      protocol: TCP
      name: http
  selector:
    {{- $ctx := merge (dict "component" $component) . -}}
    {{- include "logos.componentSelectorLabels" $ctx | nindent 4 }}
---
{{- $component := "interactive-chat" -}}
apiVersion: v1
kind: Service
metadata:
  name: {{ include "logos.interactiveChat.fullname" . }}
  labels:
    {{- include "logos.labels" . | nindent 4 }}
    app.kubernetes.io/component: {{ $component }}
spec:
  type: {{ .Values.interactiveChat.service.type }}
  ports:
    - port: {{ .Values.interactiveChat.service.port }}
      targetPort: http
      protocol: TCP
      name: http
  selector:
    {{- $ctx := merge (dict "component" $component) . -}}
    {{- include "logos.componentSelectorLabels" $ctx | nindent 4 }}
---
{{- if .Values.global.useRedisLimiter }}
{{- $component := "redis" -}}
apiVersion: v1
kind: Service
metadata:
  name: {{ include "logos.redis.fullname" . }}
  labels:
    {{- include "logos.labels" . | nindent 4 }}
    app.kubernetes.io/component: {{ $component }}
spec:
  type: ClusterIP
  ports:
    - port: 6379
      targetPort: redis
      protocol: TCP
      name: redis
  selector:
    {{- $ctx := merge (dict "component" $component) . -}}
    {{- include "logos.componentSelectorLabels" $ctx | nindent 4 }}
{{- end }}
